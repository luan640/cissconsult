{% extends "base.html" %}
{% load static %}

{% block title %}{{ campaign.title }} | PLATAFORMA NR-1{% endblock %}

{% block extra_head %}
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
  <style>
    .campaign-access {
      max-width: 980px;
      margin: 32px auto 60px;
      width: 100%;
      padding: 0 16px;
    }
    .campaign-access__header {
      text-align: center;
      display: grid;
      gap: 10px;
      margin-bottom: 16px;
    }
    .campaign-access__icon {
      width: 34px;
      height: 34px;
      margin: 0 auto;
      border-radius: 12px;
      background: #e6efff;
      color: #2563eb;
      display: grid;
      place-items: center;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.18);
    }
    .campaign-access__title {
      margin: 0;
      font-size: clamp(1.55rem, 2vw + 1rem, 2.2rem);
      line-height: 1.2;
      font-weight: 800;
      letter-spacing: -0.02em;
    }
    .campaign-access__step {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 12px;
      border-radius: 999px;
      background: #dbeafe;
      color: #1d4ed8;
      font-weight: 700;
      font-size: 0.82rem;
      width: fit-content;
      margin: 0 auto;
    }
    .campaign-access__lead {
      margin: 0 auto;
      max-width: 620px;
      color: var(--slate-600);
      font-size: 0.98rem;
    }
    .campaign-access__progress {
      height: 10px;
      border-radius: 999px;
      background: #e2e8f0;
      border: 1px solid #cbd5e1;
      overflow: hidden;
      max-width: 560px;
      margin: 12px auto 0;
      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.08);
    }
    .campaign-access__progress span {
      display: block;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #0f172a, #1e293b);
      border-radius: inherit;
    }
    .campaign-access__card {
      padding: 22px 22px 18px;
      max-width: 640px;
      margin: 0 auto;
    }
    .campaign-access__company {
      text-align: center;
      margin-bottom: 16px;
    }
    .campaign-access__company p {
      margin: 4px 0 0;
      color: var(--slate-600);
    }
    .info-block {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid transparent;
      margin-bottom: 12px;
      background: #f8fafc;
    }
    .info-block__icon {
      width: 28px;
      height: 28px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      font-size: 0.9rem;
      font-weight: 800;
    }
    .info-block__title {
      margin: 0;
      font-size: 0.9rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .info-block__text {
      margin: 6px 0 0;
      color: #334155;
      font-size: 0.9rem;
    }
    .info-block--success {
      background: #ecfdf3;
      border-color: #bbf7d0;
    }
    .info-block--success .info-block__icon {
      background: #dcfce7;
      color: #166534;
    }
    .info-block--info {
      background: #eff6ff;
      border-color: #bfdbfe;
    }
    .info-block--info .info-block__icon {
      background: #dbeafe;
      color: #1d4ed8;
    }
    .campaign-form {
      margin-top: 10px;
      padding: 0;
      gap: 10px 16px;
    }
    .form-field label {
      text-transform: none;
      letter-spacing: 0;
    }
    .form-field .label-meta {
      font-size: 0.72rem;
      font-weight: 700;
      color: #ef4444;
      margin-left: 6px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .form-field .label-required {
      color: #0f172a;
      font-weight: 800;
    }
    .campaign-form .form-actions {
      justify-content: flex-end;
    }
    .instructions-card {
      grid-column: 1 / -1;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 12px;
      padding: 12px 14px;
      color: #1d4ed8;
      font-size: 0.88rem;
    }
    .instructions-card ul {
      margin: 8px 0 0;
      padding-left: 16px;
    }
    .instructions-card li {
      margin-bottom: 4px;
    }
    .campaign-access__button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    @media (max-width: 720px) {
      .campaign-access__card {
        padding: 18px 16px;
      }
      .campaign-access__progress {
        max-width: 100%;
      }
    }
  </style>
{% endblock %}

{% block content %}
<main class="campaign-access">
  <header class="campaign-access__header">
    <div class="campaign-access__icon" aria-hidden="true">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M12 12c2.76 0 5-2.3 5-5.1C17 4.1 14.76 2 12 2S7 4.1 7 6.9C7 9.7 9.24 12 12 12Z" stroke="currentColor" stroke-width="1.6" />
        <path d="M4 21c0-4.2 3.6-7.6 8-7.6s8 3.4 8 7.6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
      </svg>
    </div>
    <h1 class="campaign-access__title">AVALIA NR01 | Ferramenta de Indicador de Estresse</h1>
    <div class="campaign-access__step">Etapa 1 de 10</div>
    <p class="campaign-access__lead">
      Este questionario e totalmente anonimo e contem perguntas sobre suas condicoes de trabalho.
      Sua opiniao e essencial para melhorar o ambiente de trabalho.
    </p>
    <div class="campaign-access__progress" role="presentation" style="height: 10px; background: #e2e8f0; border: 1px solid #cbd5e1;">
      <span style="display: block; height: 100%; width: 10%; background: #0f172a;"></span>
    </div>
  </header>

  <section class="card campaign-access__card">
    <div class="campaign-access__company">
      <strong>{{ company.name }}</strong>
      <p>CNPJ: {{ company.cnpj|default:"-" }}</p>
    </div>

    <div class="info-block info-block--success">
      <div class="info-block__icon" aria-hidden="true">✓</div>
      <div>
        <p class="info-block__title">Avaliacao verificada</p>
        <p class="info-block__text">
          Esta avaliacao faz parte de uma campanha oficial. Seu CPF sera criptografado e utilizado
          apenas para validar que voce respondeu apenas uma vez. A empresa nao tera acesso ao seu CPF
          nem podera identificar suas respostas individuais.
        </p>
      </div>
    </div>

    <div class="info-block info-block--info">
      <div class="info-block__icon" aria-hidden="true">ⓘ</div>
      <div>
        <p class="info-block__title">Garantia de anonimato</p>
        <p class="info-block__text">
          Todas as informacoes coletadas neste formulario sao completamente anonimas. Seus dados pessoais
          nao serao disponibilizados para a empresa. Utilizamos essas informacoes apenas para analises
          estatisticas agregadas que ajudarao a melhorar o ambiente de trabalho.
        </p>
        <p class="info-block__text">
          Esta avaliacao tem como objetivo compreender melhor o ambiente de trabalho e identificar
          fatores de riscos psicossociais que possam impactar a saude dos trabalhadores, contribuindo
          para a melhoria continua das condicoes de trabalho, conforme determina a NR 01.
        </p>
      </div>
    </div>

    {% if messages %}
      <section class="stack-gap" style="margin-bottom: 16px;">
        {% for message in messages %}
          <div class="notice{% if message.tags %} notice--{{ message.tags }}{% endif %}">{{ message }}</div>
        {% endfor %}
      </section>
    {% endif %}

    <form method="post" class="form-grid campaign-form">
      {% csrf_token %}
      <input type="hidden" name="step" value="1" />
      <div class="form-field">
        <label for="cpf"><span class="label-required">CPF (Obrigatorio)</span> <span class="label-meta">*</span></label>
        <input id="cpf" name="cpf" required maxlength="14" placeholder="000.000.000-00" />
      </div>
      <div class="form-field">
        <label for="first_name">Primeiro Nome <span class="label-meta">Opcional</span></label>
        <input id="first_name" name="first_name" placeholder="Seu nome" />
      </div>
      <div class="form-field">
        <label for="age"><span class="label-required">Idade</span> <span class="label-meta">*</span></label>
        <input id="age" name="age" type="number" min="1" required />
      </div>
      <div class="form-field">
        <label for="sex">Sexo</label>
        <select id="sex" name="sex">
          <option value="">Prefiro nao informar</option>
          <option value="feminino">Feminino</option>
          <option value="masculino">Masculino</option>
          <option value="outro">Outro</option>
        </select>
      </div>
      <div class="form-field">
        <label for="ghe_id"><span class="label-required">GHE</span> <span class="label-meta">*</span></label>
        <select id="ghe_id" name="ghe_id" required>
          <option value="">Selecione</option>
          {% for ghe in ghes %}
            <option value="{{ ghe.id }}">{{ ghe.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-field">
        <label for="department_id"><span class="label-required">Cargo/Funcao</span> <span class="label-meta">*</span></label>
        <select id="department_id" name="department_id" required>
          <option value="">Selecione</option>
          {% for department in departments %}
            <option value="{{ department.id }}">{{ department.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="instructions-card">
        <strong>Instrucoes:</strong>
        <ul>
          <li>O questionario leva cerca de 10 minutinhos</li>
          <li>Marque apenas uma resposta por pergunta</li>
          <li>Suas respostas sao completamente anonimas</li>
          <li>Em caso de duvidas, entre em contato com seu supervisor</li>
        </ul>
      </div>
      <div class="form-actions">
        <button class="btn btn--primary campaign-access__button" type="submit">
          Comecar Avaliacao
          <span aria-hidden="true">→</span>
        </button>
      </div>
    </form>
  </section>
</main>
{% endblock %}
